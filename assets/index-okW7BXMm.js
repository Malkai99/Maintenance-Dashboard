import{j as e,r as d,R as T}from"./react-L_ukdsnw.js";import{c as q}from"./react-dom-50bK44qw.js";import{D}from"./react-chartjs-2-o_NvxRvI.js";import{S as z}from"./react-slick-zyv5WSLU.js";/* empty css                       */import{F as B}from"./react-icons-LqCbCNTM.js";import{C as G,A as _,p as W,a as U}from"./chart.js-uyaxlqz9.js";import{u as A,Q,a as V}from"./@tanstack-373Yztxk.js";import{f as R,e as K}from"./date-fns-wFvVjSxK.js";import{e as H}from"./react-datepicker-DFLYum_3.js";import{r as J}from"./react-responsive-b9SflI7d.js";import"./classnames-Qe22oBeS.js";import"./scheduler-iwWdm5Ml.js";import"./lodash.debounce-5mBl9nYv.js";import"./resize-observer-polyfill-802KOfsG.js";import"./json2mq-hkdWEevq.js";import"./string-convert-NV8PTOlN.js";import"./enquire.js-6Qlgqrhw.js";import"./@kurkle-sRCxMDZz.js";import"./@babel-blHd5-vz.js";import"./react-onclickoutside-urJW6kcO.js";import"./react-popper-CogaYvqk.js";import"./react-fast-compare-55LePW81.js";import"./@popperjs-zyV4rJhQ.js";import"./warning-tq1HNrfO.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const l of r)if(l.type==="childList")for(const o of l.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function n(r){const l={};return r.integrity&&(l.integrity=r.integrity),r.referrerPolicy&&(l.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?l.credentials="include":r.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function i(r){if(r.ep)return;r.ep=!0;const l=n(r);fetch(r.href,l)}})();const X=({title:t,subtitle:s,value:n})=>{const i={plugins:{legend:{display:!1},tooltip:{enabled:!1}},responsive:!0,maintainAspectRatio:!1,aspectRatio:2,layout:{padding:40}},r={labels:[t,s],datasets:[{label:"Efectividad",data:[n,100-n],backgroundColor:["#598234","#2B2B36"],borderColor:["#598234","#2B2B36"],borderWidth:1,circumference:180,rotation:270,cutout:"75%"}]},l={id:"gaugePointer",afterDatasetsDraw(o,u,x){const{ctx:c,data:a}=o,f=o.getDatasetMeta(0).data[0].x,h=o.getDatasetMeta(0).data[0].y,b=o.getDatasetMeta(0).data[0].outerRadius,j=o.getDatasetMeta(0).data[0].innerRadius,p=b-j,y=b-j+p,g=0-b-p/2,v=Math.PI/180,S=6,m=o.getDatasetMeta(0).data[0].$context.raw;function w(C){return C.reduce((k,N)=>k+N,0)}const O=a.datasets[0].data.map((C,k)=>C),E=w(O),L=m/E*100,I=m/E*180-90;c.save(),c.translate(f,h),c.rotate(v*I),c.beginPath(),c.fillStyle="#598234",c.roundRect(0-S/2,g,S,y,5),c.fill(),c.restore();function F(){const N=30*(o.chartArea.width/o.chartArea.height);return N>60?60:N}c.font=`bold ${F()}px Inter sans-serif`,c.fillStyle="black",c.textAlign="center",c.textBaseline="bottom",c.fillText(`${L.toFixed(0)}%`,f,h)}};return e.jsxs("div",{className:"card__container block w-full px-8 py-5 max-w-full 2xl:max-w-[100%] lg:max-w-[600px] lg:max-h-[350px] max-h-80  h-[350px] 2xl:max-h-96 bg-white rounded-2xl shadow-cardShadow ",children:[e.jsx("h3",{className:"font-roboto font-bold w-full text-2xl md:text-3xl xl:text-4xl text-grey-text select-none",children:t}),e.jsx("div",{className:"relative block h-full w-[99%]",children:e.jsx(D,{options:i,data:r,plugins:[l]})})]})},Y=({children:t})=>{const s={dots:!0,arrows:!0,infinite:!1,speed:500,slidesToShow:1,slidesToScroll:1};return e.jsx(z,{...s,children:t})},Z=({closeModal:t,title:s,children:n})=>{const i={buttonStyles:"focus:outline-0  text-blue-button border-blue-button hover:border-blue-button border bg-transparent border-opacity-40 hover:border-opacity-100 hover:bg-blue-button hover:bg-opacity-[.05]",transitionStyle:"transition-bg button-ease duration-200"};return e.jsxs("div",{className:"fixed inset-0 flex items-center justify-center z-10",children:[e.jsx("div",{className:"absolute inset-0 bg-black  opacity-50",onClick:t}),e.jsxs("div",{className:"z-20 bg-white p-8 w-[90%] max-w-[500px] rounded-lg shadow-cardShadow flex flex-col",children:[s&&e.jsx("h3",{className:"text-xl font-semibold mb-4",children:s}),n,t&&e.jsx("button",{className:`mt-8 ${i.buttonStyles} ${i.transitionStyle}`,onClick:t,children:"Cerrar"})]})]})},ee=({text:t,children:s})=>{const[n,i]=d.useState(!1),r=d.useRef(null),l=d.useRef(null),o=c=>{n||i(!0)},u=()=>{n&&i(!1)},x=c=>{r.current&&!r.current.contains(c.target)&&l.current&&!l.current.contains(c.target)&&i(!1)};return d.useEffect(()=>(document.addEventListener("mousedown",x),()=>{document.removeEventListener("mousedown",x)}),[]),e.jsxs("div",{className:"relative inline-block",children:[e.jsx("span",{ref:l,onClick:o,className:`${n?"cursor-pointer":"cursor-default"}`,children:s}),n&&e.jsx("div",{ref:r,onClick:u,className:` cursor-pointer select-none absolute z-10 bg-black text-white p-2 rounded-md -left-2 top-full text-sm sm:text-base max-w-[200px] lg:max-w-[300px] lg:w-[300px] w-[200px] transition-all duration-300 ease-in-out ${n?"opacity-100 transform scale-100":"opacity-0 transform scale-95"}`,children:t})]})},te=({machines:t})=>{const[s,n]=d.useState(!1),[i,r]=d.useState(null),l=a=>a?"text-green-success":"text-red-alert",o=a=>({true:"Activo",false:"Inactivo"})[a],u=a=>{a.isActive||(n(!0),r(a.requests))},x=()=>{n(!1),r(null)},c=()=>i.map((a,f)=>e.jsxs(d.Fragment,{children:[e.jsxs("p",{children:["Folio: ",a.folio]}),e.jsxs("p",{children:["Status: ",a.status]}),e.jsxs("p",{children:["Departamento: ",a.department]}),e.jsxs("p",{children:["Tiempo transcurrido: ",a.elapsedTime]})]},f));return e.jsxs("div",{className:"font-roboto 2xl:max--[100%] lg:max-w-[100%] lg:max-h-[350px] h-[350px] card__container block w-full pl-8 py-5 max-w-full max-h-80 2xl:max-h-96 bg-white rounded-2xl shadow-cardShadow ",children:[e.jsxs("h3",{className:"font-roboto font-bold w-full text-2xl md:text-3xl xl:text-4xl text-grey-text flex ",children:[e.jsx("p",{className:"select-none",children:"Maquinas"}),e.jsx(ee,{text:"Haz clic en la máquina 'Inactiva' para más detalles.",children:e.jsx(B,{style:{marginLeft:"5px",cursor:"pointer",width:"20px"},title:"Más información"})})]}),e.jsx("ul",{className:"h-[80%] flex flex-col overflow-y-auto pr-5 sm:pr-[10%] mt-3",children:t.map((a,f)=>e.jsxs("li",{className:"relative flex justify-between items-center flex-wrap h-auto w-full my-5",children:[e.jsx("p",{className:"cursor-default select-none",children:a.name}),e.jsx("p",{onClick:()=>u(a),className:`${a&&a.isActive==!1?"cursor-pointer":"cursor-default"} select-none ${l(a.isActive)} `,children:o(a.isActive)})]},f))}),s&&i&&e.jsx(Z,{title:"Información de la máquina",closeModal:x,children:e.jsx(Y,{children:c()})})]})},se=({title:t,qty:s})=>e.jsxs("div",{className:"flex flex-col items-center md:w-[280px] w-[80%] h-[150px] p-[20px] xl:p-[2%] justify-center bg-white rounded-2xl shadow-cardShadow my-5 md:my-0 ",children:[e.jsx("p",{className:"font-roboto font-semibold text-6xl select-none",children:s}),e.jsx("h2",{className:"font-roboto font-bold text-3xl select-none",children:t})]});G.register(_,W,U);const re=({title:t,value:s})=>{const n=o=>{const u={Disponibilidad:"#3498DB",Rendimiento:"#B30000",Calidad:"#FFC029",default:"#598234"};return u[o]||u.default},i={plugins:{legend:{display:!1},tooltip:{enabled:!1,mode:"dataset"}},responsive:!0,maintainAspectRatio:!1,aspectRatio:1,layout:{padding:20}},r={labels:["OEE","Waste"],datasets:[{label:"Effectiveness",data:[s,100-s],backgroundColor:[n(t),"#E2E2E2"],borderColor:[n(t),"#E2E2E2"],borderWidth:1,rotation:90,cutout:"85%"}]},l={id:"gaugePointer",afterDatasetsDraw(o){const{ctx:u}=o,x=o.getDatasetMeta(0).data[0].x,c=o.getDatasetMeta(0).data[0].y;function a(){const b=52*(o.chartArea.width/o.chartArea.height);return b>60?60:b}u.font=`bold ${a()}px Inter sans-serif`,u.fillStyle=n(t),u.textAlign="center",u.textBaseline="middle",u.fillText(`${s}%`,x,c)}};return e.jsxs("div",{className:"card__container block w-full px-8 py-5 max-w-full 2xl:max-w-[100%] lg:max-w-[600px] lg:max-h-[350px] max-h-80  h-[350px] 2xl:max-h-96 bg-white rounded-2xl shadow-cardShadow ",children:[e.jsx("h3",{className:"font-roboto font-bold w-full text-2xl md:text-3xl xl:text-4xl text-grey-text select-none ",children:t}),e.jsx("div",{className:"relative block h-[90%] w-[99%]",children:e.jsx(D,{options:i,data:r,plugins:[l]})})]})},ne=async(t,s,n)=>{if(t===null||s===null||n===null)throw new Error("Alguno de los parámetros es null");const i="https://andonapi.azurewebsites.net",r=new URLSearchParams({productId:t,shift:s,date:n});return await(await fetch(`${i}/api/cells/dashboard?${r}`)).json()},oe=(t,s,n)=>A({queryKey:["dashboard",t,s,n],queryFn:()=>ne(t,s,n)}),ae=()=>e.jsxs("div",{className:"flex items-center justify-center h-screen select-none",children:[e.jsx("div",{className:"animate-spin rounded-full border-t-2 border-blue-500 border-t-blue-500 h-12 w-12"}),e.jsx("span",{className:"ml-4 text-blue-500 font-semibold text-xl",children:"Cargando..."})]}),$=d.createContext(),le=({children:t})=>{const[s,n]=d.useState(null),[i,r]=d.useState(null),[l,o]=d.useState(R(new Date,"MM/dd/yyyy")),u={shift:s,cell:i,date:l,setShift:n,setCell:r,setDate:o};return e.jsx($.Provider,{value:u,children:t})},P=()=>{const t=d.useContext($);if(!t)throw new Error("useGlobalState debe usarse dentro de un GlobalStateProvider");return t},ce=()=>{const{shift:t,cell:s,date:n}=P(),{data:i,isLoading:r,isError:l,isFetching:o,refetch:u}=oe(s,t,n),{machines:x=[{}],metrics:c=[{}],production:a}=i||{},f={gridStyles:"dashboard__container block relative w-full h-auto grid gap-6 xl:grid-cols-3 xl:grid-rows-2 md:grid-cols-2 sm:grid-cols-1 sm:grid-auto-rows-auto",marginStyles:"lg:px-20 md:px-10 px-5 my-10 pb-12",buttonStyles:"focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-100 focus:ring-blue-500 hover:border-blue-500"};if(r||o)return e.jsx(ae,{});if(l)return e.jsx("div",{className:"flex items-center justify-center h-screen",children:e.jsxs("div",{className:"text-center text-red-600 font-bold p-8 border border-red-600 bg-red-100 rounded-md max-w-md",children:[e.jsx("p",{className:"mb-4",children:"Error al cargar los datos. Inténtalo de nuevo más tarde."}),e.jsx("button",{className:` ${f.buttonStyles} bg-blue-500 text-black px-4 py-2 rounded-md shadow-md border border-blue-700`,onClick:u,children:"Volver a intentar"})]})});const h={doughnut:re,gauge:X},b=(p,y)=>{const g=h[p.type];return g?e.jsx(g,{value:p.value,title:p.title,subtitle:p.subtitle},`${p.type}-${y}`):(console.warn(`Unknown metric type: ${p.type}`),null)},j=p=>{if(p&&Array.isArray(p))return p.map((y,g)=>e.jsx(se,{title:y.title,qty:y.value},g));console.warn("Invalid production data format")};return e.jsxs("div",{className:`${f.gridStyles} my-10 pb-12 md:pb-0`,children:[e.jsx("div",{className:"flex flex-col justify-between items-center 2xl:max-h-[350px]",children:a&&j(a)}),x&&e.jsx(te,{machines:x}),c&&Array.isArray(c)&&c.map(b)]})},ie=t=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:15,height:16,fill:"none",...t,children:e.jsx("path",{stroke:"#151D48",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"m3.997 6 3.51 4 3.51-4"})}),M=({options:t,isFilterEnable:s,changeGlobalState:n})=>{const[i,r]=d.useState([]),[l,o]=d.useState(!1),[u,x]=d.useState(""),c=d.useRef(null),a=d.useRef(null),f=d.useRef(null),h={fontStyles:"font-roboto font-bold text-dark-charcoal text-sm sm:text-xl",buttonStyles:"focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-100 focus:ring-blue-500 hover:border-blue-500"},b=()=>{if(t){const m=t.find(w=>w.isSelected);r(m||null),n(m.value)}};d.useEffect(()=>{t&&Array.isArray(t)&&b()},[t]),d.useEffect(()=>{const m=w=>{c.current&&a.current&&!c.current.contains(w.target)&&!a.current.contains(w.target)&&(v(),o(!1),g())};return document.addEventListener("mousedown",m),()=>{document.removeEventListener("mousedown",m)}},[]);const j=()=>{o(!l)},p=m=>{x(m.target.value.toLowerCase())},y=m=>{r(m),n(m.value),g(),v(),j()},g=()=>{a.current&&(a.current.scrollTop=0)},v=()=>{x(""),f.current&&(f.current.value="")},S=d.useCallback(()=>Array.isArray(t)?s?t.filter(m=>m.text.toLowerCase().includes(u.toLowerCase())):t:[],[u,s,t]);return e.jsxs("div",{className:`relative group w-[100%] h-[100%] ${h.fontStyles}`,children:[e.jsxs("button",{ref:c,onClick:j,readOnly:!0,className:`relative h-full flex justify-center items-center w-full px-4 py-2 text-sm font-medium text-gray-700 bg-white rounded-xl shadow-cardShadow hover:border-blue-button ${h.buttonStyles}`,children:[e.jsx("span",{className:`mr-2 ${h.fontStyles} `,children:i.text}),e.jsx(ie,{className:"absolute right-[10%]"})]}),e.jsxs("div",{ref:a,className:`${l?"":"hidden"} absolute right-0 mt-2 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5 p-1 space-y-1 z-10 w-full max-h-[200px] overflow-y-auto ${h.fontStyles} `,children:[s&&e.jsx("input",{ref:f,className:`block w-full px-4 py-2 text-gray-800 font-normal focus:outline-none ${s?"active":"hidden"}`,type:"text",placeholder:"Buscar...",autoComplete:"on",onChange:p}),t&&S().map((m,w)=>e.jsx("option",{value:m.value,onClick:()=>y(m),className:"font-normal block px-4 py-2 text-gray-700 hover:bg-gray-100 active:bg-blue-100 cursor-pointer rounded-md",children:m.text},w))]})]})},de=async()=>await(await fetch("https://andonapi.azurewebsites.net/api/shift/select")).json(),ue=()=>A({queryKey:["shifts"],queryFn:()=>de(),refetchOnWindowFocus:!1,onError:s=>{console.error("Error en la consulta de celdas:",s)}}),xe=async()=>await(await fetch("https://andonapi.azurewebsites.net/api/product/select/plc")).json(),fe=()=>A({queryKey:["cells"],queryFn:()=>xe(),refetchOnWindowFocus:!1,onError:s=>{console.error("Error en la consulta de celdas:",s)}}),me=()=>{const{setShift:t,setCell:s,setDate:n}=P(),[i,r]=d.useState(new Date),l=J.useMediaQuery({maxWidth:768}),{data:o}=ue(),{data:u}=fe(),x={cardStyles:"flex items-center justify-center bg-white rounded-xl shadow-cardShadow ",buttonStyles:"flex items-center justify-center bg-transparent  w-[200px] h-[50px]",fontStyles:"font-roboto font-bold text-dark-charcoal text-sm sm:text-xl md:text-base lg:text-xl",marginStyles:"px-0 sm:px-5 py-5 ",dateStyles:"select-none focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-100 focus:ring-blue-button hover:border-blue-button hover:border"};function c(f){r(f),n(R(f,"MM/dd/yyyy"))}const a=d.forwardRef(({value:f,onClick:h},b)=>e.jsx("button",{className:`w-full h-full bg-white rounded-xl datepicker-input text-center cursor-pointer ${x.dateStyles}`,onClick:h,ref:b,readOnly:!0,children:f}));return e.jsxs("div",{className:"relative flex justify-center w-full h-auto mt-[30px]",children:[e.jsx("div",{className:"w-1/3 h-full flex justify-start",children:e.jsx("div",{className:`${x.fontStyles} ${x.buttonStyles} `,children:e.jsx(M,{options:u,isFilterEnable:!0,changeGlobalState:s})})}),e.jsx("div",{className:"w-1/3 h-full flex justify-center mx-2 md:mx-0",children:e.jsx("div",{className:` ${x.fontStyles} w-[200px] h-[50px]`,children:e.jsx(M,{options:o,isFilterEnable:!1,changeGlobalState:t})})}),e.jsx("div",{className:"w-1/3 h-full flex justify-end",children:e.jsx("div",{className:`datepicker-container ${x.cardStyles} ${x.fontStyles} p-0 w-[100%] xl:w-[80%] h-[50px]`,children:e.jsx(H,{selected:i,onChange:c,dateFormat:l?"dd MMMM":"EEEE dd MMMM yyyy",locale:K,maxDate:new Date,customInput:e.jsx(a,{})})})})]})},pe=new Q;function he(){return e.jsxs(V,{client:pe,children:[e.jsx(le,{children:e.jsx("div",{className:"App w-full  xl:h-screen flex flex-col bg-white-smoke theme-light",children:e.jsxs("section",{className:" block relative w-full h-full lg:px-20 md:px-10 px-5",children:[e.jsx(me,{}),e.jsx(ce,{})]})})}),!1]})}q.createRoot(document.getElementById("root")).render(e.jsx(T.StrictMode,{children:e.jsx(he,{})}));
